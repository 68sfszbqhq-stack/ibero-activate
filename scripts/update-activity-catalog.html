<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actualizar Cat√°logo de Actividades - IBERO ACT√çVATE</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #c4161c;
        }

        button {
            background: #c4161c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-right: 10px;
        }

        button:hover {
            background: #a01218;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        #log {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #17a2b8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üìö Actualizar Cat√°logo de Actividades</h1>

        <div class="info">
            <strong>‚ÑπÔ∏è Informaci√≥n:</strong> Este script actualizar√° el cat√°logo de actividades en Firestore con la
            estructura completa incluyendo im√°genes, materiales e instrucciones detalladas.
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è Opciones:</strong><br>
            - <strong>Actualizar Existentes:</strong> Agrega campos faltantes sin borrar actividades<br>
            - <strong>Reemplazar Todo:</strong> Borra todo y carga el cat√°logo completo desde cero
        </div>

        <button onclick="actualizarExistentes()">üîÑ Actualizar Existentes</button>
        <button onclick="reemplazarTodo()">üóëÔ∏è Reemplazar Todo</button>

        <div id="log"></div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="../js/firebase-config.js"></script>

    <script>
        const logElement = document.getElementById('log');

        // Override console para mostrar en UI
        const originalLog = console.log;
        console.log = function (...args) {
            originalLog.apply(console, args);
            logElement.textContent += args.join(' ') + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        };

        // Cat√°logo completo de actividades
        const catalogoActividades = [
            {
                activityId: "AF-01",
                categoria: "F√≠sica",
                name: "Energ√≠a Express",
                objetivo: "Aumentar energ√≠a y mejorar estado de √°nimo",
                duration: 5,
                materials: "Cron√≥metro (App Seconds), Bocina",
                imagen: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&w=800&q=80",
                instrucciones: [
                    "Fase 1 (1 min): Lubricaci√≥n articular (cuello, hombros, torso)",
                    "Fase 2 (3 min): Circuito (Sentadillas, Elevaci√≥n de rodillas, Flexiones pared, Saltos tijera)",
                    "Fase 3 (1 min): Vuelta a la calma (Estiramientos)"
                ],
                emoji: "‚ö°",
                type: "indoor",
                intensity: "moderada",
                benefitType: ["F√≠sico", "Psicol√≥gico"],
                specificBenefits: ["Aumenta energ√≠a", "Mejora estado de √°nimo", "Activa circulaci√≥n"],
                description: "Secuencia r√°pida de ejercicios para aumentar energ√≠a y mejorar el estado de √°nimo en solo 5 minutos."
            },
            {
                activityId: "FG-01",
                categoria: "Juegos",
                name: "Spaghetti-V√≥ley",
                objetivo: "Trabajo en equipo y coordinaci√≥n",
                duration: 15,
                materials: "Tubos de espuma ('spaguetis'), globo o pelota de playa",
                imagen: "https://images.unsplash.com/photo-1612872087720-bb876e2e67d1?auto=format&fit=crop&w=800&q=80",
                instrucciones: [
                    "Dividir en dos equipos con una l√≠nea imaginaria",
                    "Pasar el globo al campo contrario usando solo los tubos de espuma",
                    "Si el globo cae, es punto para el equipo contrario"
                ],
                emoji: "üéà",
                type: "outdoor",
                intensity: "moderada",
                benefitType: ["F√≠sico", "Social"],
                specificBenefits: ["Fomenta trabajo en equipo", "Mejora coordinaci√≥n", "Fomenta integraci√≥n"],
                description: "Juego din√°mico en equipo que combina coordinaci√≥n, estrategia y diversi√≥n usando tubos de espuma."
            },
            {
                activityId: "JM-04",
                categoria: "Mesa",
                name: "UNO (Cl√°sico)",
                objetivo: "Interacci√≥n social y pensamiento estrat√©gico simple",
                duration: 20,
                materials: "Mazo de cartas UNO",
                imagen: "https://images.unsplash.com/photo-1605304383472-3c2243e39c4f?auto=format&fit=crop&w=800&q=80",
                instrucciones: [
                    "Deshacerse de todas las cartas coincidiendo n√∫mero o color",
                    "Usar cartas especiales (Reversa, Toma 2) estrat√©gicamente",
                    "Gritar 'UNO' cuando quede una sola carta"
                ],
                emoji: "üé¥",
                type: "desk",
                intensity: "baja",
                benefitType: ["Psicol√≥gico", "Social"],
                specificBenefits: ["Reduce estr√©s", "Mejora clima laboral", "Fomenta integraci√≥n"],
                description: "Cl√°sico juego de cartas que fomenta la interacci√≥n social y el pensamiento estrat√©gico de forma divertida."
            },
            {
                activityId: "RC-02",
                categoria: "Relax",
                name: "Meditaci√≥n Guiada",
                objetivo: "Eliminar estr√©s y mejorar concentraci√≥n",
                duration: 10,
                materials: "Sillas c√≥modas, bocina, ambiente tranquilo",
                imagen: "https://images.unsplash.com/photo-1506126613408-eca07ce68773?auto=format&fit=crop&w=800&q=80",
                instrucciones: [
                    "Sentarse c√≥modamente y cerrar los ojos",
                    "Seguir el audio o voz del instructor enfoc√°ndose en la respiraci√≥n",
                    "Liberar pensamientos y buscar la calma"
                ],
                emoji: "üßò",
                type: "indoor",
                intensity: "baja",
                benefitType: ["Psicol√≥gico"],
                specificBenefits: ["Reduce estr√©s", "Mejora concentraci√≥n", "Mejora estado de √°nimo"],
                description: "Sesi√≥n de meditaci√≥n guiada para eliminar el estr√©s y mejorar la concentraci√≥n a trav√©s de la atenci√≥n plena."
            },
            {
                activityId: "CR-01",
                categoria: "Caminata",
                name: "Caminata Consciente",
                objetivo: "Conexi√≥n personal y atenci√≥n plena",
                duration: 15,
                materials: "Tarjetas 'Somos' (opcional), ruta segura",
                imagen: "https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?auto=format&fit=crop&w=800&q=80",
                instrucciones: [
                    "Fase 1 (5 min): Conexi√≥n y reflexi√≥n en parejas con preguntas",
                    "Fase 2 (7 min): Caminata enfocada en respiraci√≥n y entorno",
                    "Fase 3 (3 min): Cierre y compartir reflexi√≥n grupal"
                ],
                emoji: "üö∂",
                type: "outdoor",
                intensity: "baja",
                benefitType: ["F√≠sico", "Psicol√≥gico", "Social"],
                specificBenefits: ["Reduce estr√©s", "Mejora concentraci√≥n", "Mejora comunicaci√≥n", "Activa circulaci√≥n"],
                description: "Caminata consciente que combina movimiento f√≠sico con reflexi√≥n personal y conexi√≥n interpersonal."
            }
        ];

        async function actualizarExistentes() {
            console.log('üîÑ Iniciando actualizaci√≥n de actividades existentes...\n');

            let updated = 0;
            let added = 0;

            for (const actividad of catalogoActividades) {
                try {
                    // Buscar si ya existe por activityId
                    const existing = await db.collection('activities')
                        .where('activityId', '==', actividad.activityId)
                        .get();

                    if (existing.empty) {
                        // No existe, crear nueva
                        await db.collection('activities').add({
                            ...actividad,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        console.log(`‚úÖ Agregada: ${actividad.activityId} - ${actividad.name}`);
                        added++;
                    } else {
                        // Ya existe, actualizar
                        const docId = existing.docs[0].id;
                        await db.collection('activities').doc(docId).update({
                            ...actividad,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        console.log(`üîÑ Actualizada: ${actividad.activityId} - ${actividad.name}`);
                        updated++;
                    }
                } catch (error) {
                    console.log(`‚ùå Error con ${actividad.activityId}: ${error.message}`);
                }
            }

            console.log(`\n‚ú® Proceso completado:`);
            console.log(`   ‚úÖ Agregadas: ${added}`);
            console.log(`   üîÑ Actualizadas: ${updated}`);
        }

        async function reemplazarTodo() {
            if (!confirm('‚ö†Ô∏è ¬øEst√°s seguro? Esto borrar√° TODAS las actividades actuales y cargar√° el cat√°logo completo.')) {
                return;
            }

            console.log('üóëÔ∏è Eliminando actividades existentes...\n');

            // Eliminar todas las actividades
            const snapshot = await db.collection('activities').get();
            const batch = db.batch();
            snapshot.docs.forEach(doc => {
                batch.delete(doc.ref);
            });
            await batch.commit();
            console.log(`‚úÖ Eliminadas ${snapshot.size} actividades antiguas\n`);

            console.log('üìö Cargando cat√°logo completo...\n');

            for (const actividad of catalogoActividades) {
                try {
                    await db.collection('activities').add({
                        ...actividad,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    console.log(`‚úÖ ${actividad.activityId} - ${actividad.name}`);
                } catch (error) {
                    console.log(`‚ùå Error: ${error.message}`);
                }
            }

            console.log(`\n‚ú® Cat√°logo completo cargado: ${catalogoActividades.length} actividades`);
        }
    </script>
</body>

</html>